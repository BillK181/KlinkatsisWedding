{% extends "base.html" %}

{% block title %}Klinkatsis Wedding{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/rsvp.css') }}" media="all">
{% endblock %}

{% block content %}
<main>

  <!-- RSVP Background Video -->
  <section id="rsvp" aria-labelledby="rsvp-heading">
    <video id="rsvp-video" autoplay muted loop playsinline>
      <source src="{{ url_for('static', filename='images/olersvp.mp4') }}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div class="video-credit">Video by Bill Klinkatsis</div>

    <!-- Flash Message -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes" role="alert">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- RSVP Form -->
    <form action="/rsvp" method="POST" class="rsvp-form">
      <p class="rsvp-greeting">
        Hello <strong>{{ name | e }}</strong>, you have RSVP’ed 
        <span class="rsvp-status">{{ rsvp_status or "—" }}</span>!
      </p>

      {% for member in group_members %}
        <p class="rsvp-greeting">
          {{ member.name | e }}:
          <div class="select-wrapper">
            <select name="rsvp_{{ member.name | replace(' ', '_') }}" required>
              <option value="going" {% if member.rsvp_status == 'going' %}selected{% endif %}>Going</option>
              <option value="not_going" {% if member.rsvp_status == 'not_going' %}selected{% endif %}>Not Going</option>
            </select>
          </div>
        </p>
      {% endfor %}

      <input type="submit" value="{% if rsvp_status %}Change RSVP{% else %}RSVP{% endif %}" class="rsvp-submit">
    </form>

  </section>

</main>

{% endblock %}

<!-- Video Pause Script -->
<script>
  const video = document.getElementById('rsvp-video');

  // Pause video when tab is inactive
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      video.pause();
    } else {
      video.play();
    }
  });
</script>
