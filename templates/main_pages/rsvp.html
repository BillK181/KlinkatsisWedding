{% extends "base.html" %}

{% block title %}Klinkatsis Wedding{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/rsvp.css') }}" media="all">
{% endblock %}

{% block content %}
<main>

  <!-- RSVP Background Video -->
  <section id="rsvp" aria-labelledby="rsvp-heading">
    <video id="rsvp-video" autoplay muted loop playsinline>
      <source src="{{ url_for('static', filename='images/olersvp.mp4') }}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div class="video-credit">Video by Bill Klinkatsis</div>

    <!-- Flash Message -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes" role="alert">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- RSVP Form -->
    <form action="/rsvp" method="POST" class="rsvp-form">
      <p class="rsvp-greeting">
        Hello <strong>{{ name | e }}</strong>, you have RSVP’ed 
        <span class="rsvp-status">{{ rsvp_status or "—" }}</span>!
      </p>

      {% for member in group_members %}
      <div class="guest-row">
        <strong>{{ member.name | e }}</strong>

        <div class="guest-row-inputs">
          <!-- RSVP DROPDOWN -->
          <div class="select-wrapper">
            <select name="rsvp_{{ member.name | replace(' ', '_') }}" required>
              <option value="going" {% if member.rsvp_status == 'going' %}selected{% endif %}>Going</option>
              <option value="not_going" {% if member.rsvp_status == 'not_going' %}selected{% endif %}>Not Going</option>
            </select>
          </div>

          <!-- DINNER OPTION DROPDOWN -->
          <div class="select-wrapper">
            <select name="dinner_option_{{ member.name | replace(' ', '_') }}">
              <option value="" {% if not member.dinner_option %}selected{% endif %}>— Dinner —</option>
              <option value="Chicken" {% if member.dinner_option == 'Chicken' %}selected{% endif %}>Chicken</option>
              <option value="Beef" {% if member.dinner_option == 'Beef' %}selected{% endif %}>Beef</option>
              <option value="Vegetarian" {% if member.dinner_option == 'Vegetarian' %}selected{% endif %}>Vegetarian</option>
              <option value="Vegan" {% if member.dinner_option == 'Vegan' %}selected{% endif %}>Vegan</option>
            </select>
          </div>

          <!-- SONG REQUEST -->
          <input 
            type="text" 
            name="song_request_{{ member.name | replace(' ', '_') }}"
            placeholder="Song request"
            value="{{ member.song_request or '' }}"
            class="song-input"
          >
        </div>
      </div>
      {% endfor %}

      <input type="submit" value="{% if rsvp_status %}Update Info{% else %}Submit RSVP{% endif %}" class="rsvp-submit">
    </form>

  </section>

</main>
{% endblock %}

<!-- Video Pause Script -->
<script>
  const video = document.getElementById('rsvp-video');

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      video.pause();
    } else {
      video.play();
    }
  });
</script>
